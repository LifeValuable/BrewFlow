spring:
  cloud:
    gateway:
      server:
        webflux:  # ← Новый формат!
          routes:
            - id: user-service-route
              uri: http://user-service:8081
              predicates:
                - Path=/api/users/**,/api/auth/**
              filters:
                - StripPrefix=0

            - id: order-service-route
              uri: http://order-service:8082
              predicates:
                - Path=/api/orders/**,/api/cart/**,/api/products/**
              filters:
                - StripPrefix=0

            - id: payment-service-route
              uri: http://payment-service:8083
              predicates:
                - Path=/api/payments/**
              filters:
                - StripPrefix=0

            - id: notification-service-route
              uri: http://notification-service:8084
              predicates:
                - Path=/api/notifications/**
              filters:
                - StripPrefix=0

            # Actuator routes для каждого сервиса
            - id: user-actuator
              uri: http://user-service:8081
              predicates:
                - Path=/actuator/user/**
              filters:
                - RewritePath=/actuator/user/(?<segment>.*), /actuator/$\{segment}

            - id: order-actuator
              uri: http://order-service:8082
              predicates:
                - Path=/actuator/order/**
              filters:
                - RewritePath=/actuator/order/(?<segment>.*), /actuator/$\{segment}

management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  prometheus:
    metrics:
      export:
        enabled: true
  tracing:
    sampling:
      probability: 1.0
  zipkin:
    tracing:
      endpoint: http://tempo:9411/api/v2/spans
